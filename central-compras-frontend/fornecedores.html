<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fornecedores — Central de Compras</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <header class="topbar">
    <div class="brand">Central de Compras</div>
    <nav>
      <a href="dashboard.html">Dashboard</a>
      <a href="fornecedores.html">Fornecedores</a>
      <a href="campanhas.html">Campanhas</a>
      <a href="cashback.html">Cashback</a>
      <a href="index.html">Sair</a>
    </nav>
  </header>

  <main class="container">
    <h1>Fornecedores</h1>
    <div class="grid-3" id="fornecedoresList"></div>
  </main>

  <div id="ecomModal" class="modal" aria-hidden="true">
    <div class="modal-card">
      <button class="close" onclick="closeModal()">✕</button>
      <div id="modalContent"></div>
    </div>
  </div>

  <script src="js/data.js"></script>
  <script src="js/app.js"></script>
  <script>
    appAuth.maybeRequireLogin(); // allow browsing without login too

    const list = document.getElementById('fornecedoresList');
    function renderFornecedores(){
      const f = db.getFornecedores();
      list.innerHTML = '';
      f.forEach(ff=>{
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <h3>${ff.name}</h3>
          <p class="muted">${ff.city} — ${ff.state}</p>
          <p class="small">${ff.description}</p>
          <div class="row">
            <button class="btn" onclick='openEcom("${ff.id}")'>Abrir ecommerce</button>
            <a class="link small" href="#" onclick='openContact("${ff.id}")'>Contato</a>
          </div>
        `;
        list.appendChild(card);
      });
    }

    function openEcom(id){
      const f = db.getFornecedor(id);
      const html = `
        <h2>${f.name}</h2>
        <p class="muted">${f.description}</p>
        <h3>Produtos</h3>
        <div id="prodList"></div>
        <div class="row between">
          <button class="btn primary" onclick='location.href="ecommerce.html?fornecedor=${id}"'>Ir para formulário de pedido</button>
          <button class="btn alt" onclick="closeModal()">Fechar</button>
        </div>
      `;
      document.getElementById('modalContent').innerHTML = html;
      const prodList = document.getElementById('prodList');
      f.products.forEach(p=>{
        const div = document.createElement('div');
        div.className = 'product-row';
        div.innerHTML = `<strong>${p.name}</strong> <span>R$ ${p.price.toFixed(2)}</span>`;
        prodList.appendChild(div);
      });
      showModal();
    }

    function openContact(id){
      const f = db.getFornecedor(id);
      const html = `<h3>Contato — ${f.name}</h3>
        <p>Telefone: ${f.phone}</p>
        <p>Representante: ${f.representative}</p>
        <p><a href="${f.files ? f.files[0] : '#'}" target="_blank">Ver documento</a></p>
        <div class="row"><button class="btn" onclick="closeModal()">Fechar</button></div>
      `;
      document.getElementById('modalContent').innerHTML = html;
      showModal();
    }

    function showModal(){ document.getElementById('ecomModal').style.display='flex'; }
    function closeModal(){ document.getElementById('ecomModal').style.display='none'; }

    renderFornecedores();
  </script>
</body>
</html>
